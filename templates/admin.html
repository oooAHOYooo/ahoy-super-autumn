{% extends "base.html" %}

{% block title %}Admin - AHOY Indie Media{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>Admin Panel</h1>
    <div class="admin-actions">
        <a href="{{ url_for('new_event') }}" class="btn btn-primary">Add New
            Event</a>
        <a href="{{ url_for('analytics_dashboard') }}" class="btn btn-primary">ðŸ“Š Analytics</a>
        <div class="export-section">
            <h3>Export Data</h3>
            <div class="export-options">
                <div class="export-group">
                    <label for="format-select">Choose Format:</label>
                    <select id="format-select" class="format-selector">
                        <option value="pdf">PDF</option>
                        <option value="csv">CSV</option>
                        <option value="json">JSON</option>
                    </select>
                </div>
                <div class="export-buttons">
                    <button onclick="exportData('newsletter')" class="btn btn-secondary">Export Newsletter</button>
                    <button onclick="exportData('artist-submissions')" class="btn btn-secondary">Export Artist Submissions</button>
                    <button onclick="exportData('rsvps')" class="btn btn-secondary">Export RSVPs</button>
                    <button onclick="exportData('analytics')" class="btn btn-secondary">Export Analytics</button>
                    <button onclick="exportData('all-data')" class="btn btn-secondary">Export All Data</button>
                    <button onclick="exportData('report')" class="btn btn-primary">Generate Report</button>
                </div>
            </div>
        </div>
        <a href="{{ url_for('admin_logout') }}" class="btn btn-outline">Logout</a>
    </div>
</div>

<section class="admin-section">
    <div class="container">
        <h2>Manage Events</h2>
        {% if events %}
        <div class="admin-table">
            <table>
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Venue</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event in events %}
                    <tr>
                        <td>{{ event.title }}</td>
                        <td>{{ event.date }}</td>
                        <td>{{ event.time or '-' }}</td>
                        <td>{{ event.venue or '-' }}</td>
                        <td class="actions">
                            <a
                                href="{{ url_for('edit_event', event_id=event.id) }}"
                                class="btn btn-small">Edit</a>
                            <form method="POST"
                                action="{{ url_for('delete_event', event_id=event.id) }}"
                                style="display: inline;">
                                <button type="submit"
                                    class="btn btn-small btn-danger"
                                    onclick="return confirm('Are you sure?')">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No events found. <a href="{{ url_for('new_event') }}">Add your first
                event</a>.</p>
        {% endif %}
    </div>
</section>

<!-- Newsletter Subscribers Section -->
<section class="admin-section">
    <div class="container">
        <h2>Newsletter Subscribers ({{ subscribers|length }})</h2>
        {% if subscribers %}
        <div class="admin-table">
            <table>
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Signup Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for subscriber in subscribers %}
                    <tr>
                        <td>{{ subscriber.email }}</td>
                        <td>{{ subscriber.signup_date[:10] }}</td>
                        <td>{{ subscriber.status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No newsletter subscribers yet.</p>
        {% endif %}
    </div>
</section>

<!-- Artist Submissions Section -->
<section class="admin-section">
    <div class="container">
        <h2>Artist Submissions ({{ artist_submissions|length }})</h2>
        {% if artist_submissions %}
        <div class="admin-table">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Performance Type</th>
                        <th>Description</th>
                        <th>Availability</th>
                        <th>Links</th>
                        <th>Submission Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for submission in artist_submissions %}
                    <tr>
                        <td>{{ submission.name }}</td>
                        <td>{{ submission.email }}</td>
                        <td>{{ submission.performance_type.title() }}</td>
                        <td>{{ submission.description[:50] }}{% if
                            submission.description|length > 50 %}...{% endif
                            %}</td>
                        <td>{{ submission.availability[:30] }}{% if
                            submission.availability|length > 30 %}...{% endif
                            %}</td>
                        <td>
                            {% if submission.links %}
                            <a href="{{ submission.links }}" target="_blank"
                                class="btn btn-small">View</a>
                            {% else %}
                            -
                            {% endif %}
                        </td>
                        <td>{{ submission.submission_date[:10] }}</td>
                        <td>
                            <span
                                class="status-badge status-{{ submission.status }}">
                                {{ submission.status.title() }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No artist submissions yet.</p>
        {% endif %}
    </div>
</section>

<!-- RSVPs Section -->
<section class="admin-section">
    <div class="container">
        <h2>Event RSVPs ({{ all_rsvps|length }})</h2>
        {% if all_rsvps %}
        <div class="admin-table">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Event</th>
                        <th>Event Date</th>
                        <th>Guests</th>
                        <th>RSVP Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for rsvp in all_rsvps %}
                    <tr>
                        <td>{{ rsvp.name }}</td>
                        <td>{{ rsvp.email }}</td>
                        <td>{{ rsvp.event_title }}</td>
                        <td>{{ rsvp.event_date }}</td>
                        <td>{{ rsvp.guests }}</td>
                        <td>{{ rsvp.rsvp_date[:10] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No RSVPs yet.</p>
        {% endif %}
    </div>
</section>

<script>
function exportData(type) {
    const format = document.getElementById('format-select').value;
    let url = '';
    
    switch(type) {
        case 'newsletter':
            url = `/admin/export/newsletter?format=${format}`;
            break;
        case 'artist-submissions':
            url = `/admin/export/artist-submissions?format=${format}`;
            break;
        case 'rsvps':
            url = `/admin/export/rsvps?format=${format}`;
            break;
        case 'analytics':
            url = `/admin/analytics/export?format=${format}`;
            break;
        case 'all-data':
            url = `/admin/export/all-data?format=${format}`;
            break;
        case 'report':
            url = `/admin/export/pdf-report?format=${format}`;
            break;
    }
    
    if (url) {
        window.open(url, '_blank');
    }
}
</script>

<style>
.export-section {
    margin: 20px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.export-section h3 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 1.2em;
}

.export-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.export-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.export-group label {
    font-weight: 600;
    color: #555;
}

.format-selector {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background: white;
    font-size: 14px;
}

.export-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.export-buttons button {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.2s;
}

.export-buttons .btn-primary {
    background-color: #007bff;
    color: white;
}

.export-buttons .btn-primary:hover {
    background-color: #0056b3;
}

.export-buttons .btn-secondary {
    background-color: #6c757d;
    color: white;
}

.export-buttons .btn-secondary:hover {
    background-color: #545b62;
}
</style>
{% endblock %}
